/*
 * Constants.c
 *
 *  Created on: May 31, 2015
 *      Author: dongfang
 */

#include "DataTypes.h"
#include <diag/Trace.h>

const int32_t WSPRFrequencies[] = {10140200, 28126100};

const char* MY_CALLSIGN = "HB9FDK";
const uint8_t MY_SSID = 11;

const char* AX25_DEST_CALLSIGN = "";
const uint8_t AX25_DEST_SSID = 0;

const char* DIGI_PATH1;
const uint8_t DIGI_PATH1_TTL;

const char* DIGI_PATH2;
const uint8_t DIGI_PATH2_TTL;

const uint8_t WSPR_POWER_LEVEL = 10;

const CDCEL913_PLL_Setting_t settingsFor30m[] = {
		{0.3899159663865546,232,2,17,26,18},
		{0.38993506493506497,1201,2,11,17,44},
		{0.389937106918239,248,2,12,18,38},
		{0.38994708994709,737,3,10,31,37},
		{0.38995433789954337,427,2,15,23,29},
		{0.38995815899581593,932,3,10,31,47},
		{0.38996297819827236,948,2,11,17,35},
		{0.3899665551839465,583,2,13,20,32},
		{0.38996763754045305,723,2,18,28,8},
		{0.38997113997113997,1081,2,11,17,40},
		{0.3899745114698386,459,2,11,17,17},
		{0.3899782135076253,179,2,17,26,14},
		{0.38997933884297525,755,2,11,17,28},
		{0.38998682476943347,296,2,11,17,11},
		{0.38998899889988997,709,2,18,28,8},
		{0.38999662047989186,1154,2,11,17,43},
		{0.39,39,3,10,31,2},
		{0.3900093080980453,1257,2,11,17,47},
		{0.39001122334455673,695,2,18,28,8},
		{0.3900200745626613,1360,2,11,17,51},
		{0.3900226757369614,344,2,18,28,4},
		{0.39003250270855905,360,2,13,20,20},
		{0.3900343642611684,681,2,18,28,8},
		{0.39004329004329,901,3,10,31,47},
		{0.3900462962962963,337,2,18,28,4},
		{0.3900473933649289,823,3,10,31,43},
		{0.3900560224089636,557,2,17,26,44},
		{0.39005847953216377,667,3,10,31,35},
		{0.39006808169803764,974,2,11,17,37},
		{0.39007092198581556,220,2,12,18,34},
		{0.3900793650793651,983,2,18,28,12},
		{0.39008264462809916,236,2,11,17,9},
		{0.3900836320191159,653,2,18,28,8},
		{0.39009497964721845,575,2,11,17,22},
		{0.39009661835748793,323,2,12,18,50},
		{0.3901041666666667,749,3,10,31,40}
};

const CDCEL913_PLL_Setting_t settingsFor10m[] = {
		{1.081507449605609,1234,2,7,30,46},
		{1.0815126050420167,1287,2,7,30,48},
		{1.0815173527037933,1340,2,7,30,50},
		{1.0815217391304348,199,2,4,17,14},
		{1.0815602836879432,305,2,6,25,45},
		{1.081578947368421,411,2,4,17,29},
		{1.0815972222222223,623,2,4,17,44},
		{1.0816326530612244,53,2,7,30,2},
		{1.0816666666666668,649,2,4,17,46},
		{1.0816831683168318,437,2,4,17,31},
		{1.0816901408450703,384,2,5,21,45},
		{1.0816993464052287,331,2,6,25,49},
		{1.0817307692307692,225,2,4,17,16},
		{1.0817506193228736,1310,2,7,30,50},
		{1.0817555938037866,1257,2,7,30,48},
		{1.0817610062893082,344,2,6,25,51},
		{1.081766917293233,1151,2,7,30,44},
		{1.0817733990147784,1098,2,7,30,42},
		{1.0817757009345794,463,2,4,17,33},
		{1.0817805383022774,1045,2,7,30,40},
		{1.0817884405670666,992,2,7,30,38},
		{1.0817901234567902,701,2,4,17,50},
		{1.0817972350230414,939,2,7,30,36},
		{1.0818070818070817,886,2,7,30,34},
		{1.0818181818181818,119,2,5,21,14},
		{1.0818307905686546,780,2,7,30,30},
		{1.0818452380952381,727,2,7,30,28},
		{1.081858407079646,489,2,4,17,35},
		{1.0818619582664528,674,2,7,30,26},
		{1.0818713450292399,1295,2,7,30,50},
		{1.0818815331010452,621,2,7,30,24},
		{1.0818926296633302,1189,2,7,30,46},
		{1.081896551724138,251,2,4,17,18},
		{1.081904761904762,568,2,7,30,22},
		{1.081918081918082,1083,2,7,30,42},
		{1.0819327731092436,515,2,4,17,37},
		{1.0819490586932448,977,2,7,30,38},
		{1.0819672131147542,264,2,4,17,19},
		{1.0819875776397516,871,2,7,30,34},
		{1.0819949281487744,1280,2,7,30,50},
		{1.082,541,2,4,17,39},
		{1.082010582010582,409,2,7,30,16},
		{1.0820276497695853,1174,2,7,30,46},
		{1.08203125,277,2,4,17,20},
		{1.0820367751060822,765,2,7,30,30}
};

const CDCEL913_PLL_Setting_t *PLL_SETTINGS[] = {settingsFor30m, settingsFor10m};
const uint8_t PLL_SETTING_LENGTHS[] = {sizeof(settingsFor30m)/sizeof(CDCEL913_PLL_Setting_t), sizeof(settingsFor10m)/sizeof(CDCEL913_PLL_Setting_t)};

 uint8_t CDCEL913_BestSettingIndex(uint8_t band, double desiredMultiplication) {
	double minError = 1000;
	uint8_t i;
	uint8_t besti = PLL_SETTING_LENGTHS[band]/2;
	for(i=0; i<PLL_SETTING_LENGTHS[band]; i++) {
		double error = PLL_SETTINGS[band][i].mul - desiredMultiplication;
		/*
		trace_printf("i %u, besti %u, desired %u, is %u, error PPM %d\n",
				i, besti,
				(uint32_t)(desiredMultiplication * 1000),
				(uint32_t)(PLL_SETTINGS[band][i].mul * 1000),
				(int32_t)(error*1.0E6));
		*/
		if (error < 0) error = -error;
		if (error < minError) {
			besti = i;
			minError = error;
		}
	}
	return besti;
}

